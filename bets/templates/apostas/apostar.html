{% extends 'base.html' %}

{% block title %}Apostar - PalpitaIFPI{% endblock %}

{% block content %}
<h2>ðŸ’° Fazer Aposta</h2>

<div style="background: #f8f9fa; padding: 20px; border-radius: 5px; margin-top: 20px;">
    <h3>{{ jogo.time1 }} x {{ jogo.time2 }}</h3>
    <p><strong>Modalidade:</strong> {{ jogo.modalidade.nome }}</p>
    <p><strong>Data/Hora:</strong> {{ jogo.data|date:"d/m/Y H:i" }}</p>
    <p><strong>Seu XP:</strong> <strong style="color: #00ff00; font-size: 1.2em;">{{ perfil.xp }} XP</strong> | <strong>NÃ­vel:</strong> {{ perfil.nivel }}</p>
</div>

<form method="post" style="margin-top: 30px;">
    {% csrf_token %}
    
    <div class="form-group">
        <label>Tipo de Aposta:</label>
        <select name="tipo_aposta" id="tipo_aposta" onchange="mostrarMercado()" required>
            <option value="">Selecione...</option>
            <option value="1X2">Resultado 1X2</option>
            <option value="PLACAR">Placar Exato</option>
        </select>
    </div>
    
    <!-- Mercado 1X2 -->
    <div id="mercado_1x2" style="display: none; margin-top: 20px;">
        <h4>Escolha o Resultado:</h4>
        <div style="display: flex; gap: 20px; flex-wrap: wrap; margin-top: 15px;">
            <label style="flex: 1; min-width: 200px; padding: 15px; border: 2px solid #ddd; border-radius: 5px; cursor: pointer; text-align: center;">
                <input type="radio" name="aposta_1x2" value="1" required>
                <strong>{{ jogo.time1 }}</strong><br>
                <span style="color: #667eea; font-size: 1.3em; font-weight: bold;">{{ jogo.odd_time1 }}</span>
            </label>
            <label style="flex: 1; min-width: 200px; padding: 15px; border: 2px solid #ddd; border-radius: 5px; cursor: pointer; text-align: center;">
                <input type="radio" name="aposta_1x2" value="X" required>
                <strong>Empate</strong><br>
                <span style="color: #667eea; font-size: 1.3em; font-weight: bold;">{{ jogo.odd_empate }}</span>
            </label>
            <label style="flex: 1; min-width: 200px; padding: 15px; border: 2px solid #ddd; border-radius: 5px; cursor: pointer; text-align: center;">
                <input type="radio" name="aposta_1x2" value="2" required>
                <strong>{{ jogo.time2 }}</strong><br>
                <span style="color: #667eea; font-size: 1.3em; font-weight: bold;">{{ jogo.odd_time2 }}</span>
            </label>
        </div>
    </div>
    
    <!-- Mercado Placar Exato -->
    <div id="mercado_placar" style="display: none; margin-top: 20px;">
        <h4>Placar Exato (Odd: {{ jogo.odd_placar_exato }})</h4>
        <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap; margin-top: 15px;">
            <div class="form-group" style="flex: 1; min-width: 150px;">
                <label for="palpite_time1">{{ jogo.time1 }}</label>
                <input type="number" id="palpite_time1" name="palpite_time1" min="0" value="0" required>
            </div>
            <div style="font-size: 2em; font-weight: bold; color: #667eea;">x</div>
            <div class="form-group" style="flex: 1; min-width: 150px;">
                <label for="palpite_time2">{{ jogo.time2 }}</label>
                <input type="number" id="palpite_time2" name="palpite_time2" min="0" value="0" required>
            </div>
        </div>
    </div>
    
    <div class="form-group" style="margin-top: 30px;">
        <label for="valor_apostado">Valor da Aposta (R$):</label>
        <input type="number" 
               id="valor_apostado" 
               name="valor_apostado" 
               min="1" 
               step="0.01" 
               value="10.00" 
               required
               oninput="calcularGanho()">
        <small style="color: #666;">Valor mÃ­nimo: R$ 1,00</small>
    </div>
    
    <div id="ganho_potencial" style="background: #e7f3ff; padding: 15px; border-radius: 5px; margin-top: 15px; display: none;">
        <strong>Ganho Potencial:</strong> <span id="ganho_valor" style="color: #28a745; font-size: 1.2em; font-weight: bold;">R$ 0,00</span>
    </div>
    
    <div style="margin-top: 30px;">
        <button type="submit" class="btn">Confirmar Aposta</button>
        <a href="{% url 'listar_jogos' %}" class="btn btn-secondary" style="margin-left: 10px;">
            Cancelar
        </a>
    </div>
</form>

<script>
function mostrarMercado() {
    const tipo = document.getElementById('tipo_aposta').value;
    document.getElementById('mercado_1x2').style.display = tipo === '1X2' ? 'block' : 'none';
    document.getElementById('mercado_placar').style.display = tipo === 'PLACAR' ? 'block' : 'none';
    calcularGanho();
}

function calcularGanho() {
    const tipo = document.getElementById('tipo_aposta').value;
    const valor = parseFloat(document.getElementById('valor_apostado').value) || 0;
    const ganhoDiv = document.getElementById('ganho_potencial');
    const ganhoValor = document.getElementById('ganho_valor');
    
    if (tipo && valor > 0) {
        let odd = 0;
        if (tipo === '1X2') {
            const selecionado = document.querySelector('input[name="aposta_1x2"]:checked');
            if (selecionado) {
                if (selecionado.value === '1') odd = {{ jogo.odd_time1 }};
                else if (selecionado.value === 'X') odd = {{ jogo.odd_empate }};
                else if (selecionado.value === '2') odd = {{ jogo.odd_time2 }};
            }
        } else if (tipo === 'PLACAR') {
            odd = {{ jogo.odd_placar_exato }};
        }
        
        if (odd > 0) {
            const ganho = valor * odd;
            ganhoValor.textContent = 'R$ ' + ganho.toFixed(2);
            ganhoDiv.style.display = 'block';
        } else {
            ganhoDiv.style.display = 'none';
        }
    } else {
        ganhoDiv.style.display = 'none';
    }
}

// Adicionar listeners para recalcular quando mudar seleÃ§Ã£o
document.querySelectorAll('input[name="aposta_1x2"]').forEach(radio => {
    radio.addEventListener('change', calcularGanho);
});
</script>
{% endblock %}
